/*!
 * Adapted from koa-send at https://github.com/koajs/send and which is licensed
 * with the MIT license.
 */ /**
 * Contains the send function which can be used to send static assets while
 * supporting a range of HTTP capabilities.
 *
 * This is integrated into the oak context via the `.send()` method.
 *
 * @module
 */ import { basename, calculate, contentType, createHttpError, extname, ifNoneMatch, parse, range, readAll, responseRange, Status } from "./deps.ts";
import { isNode } from "./utils/type_guards.ts";
import { decodeComponent } from "./utils/decode_component.ts";
import { resolvePath } from "./utils/resolve_path.ts";
if (isNode()) {
  console.warn("oak send() does not work under Node.js.");
}
const MAXBUFFER_DEFAULT = 1_048_576; // 1MiB;
function isHidden(path) {
  const pathArr = path.split("/");
  for (const segment of pathArr){
    if (segment[0] === "." && segment !== "." && segment !== "..") {
      return true;
    }
    return false;
  }
}
async function exists(path) {
  try {
    return (await Deno.stat(path)).isFile;
  } catch  {
    return false;
  }
}
async function getEntity(path, mtime, stats, maxbuffer, response) {
  let body;
  let entity;
  const fileInfo = {
    mtime: new Date(mtime),
    size: stats.size
  };
  const file = await Deno.open(path, {
    read: true
  });
  if (stats.size < maxbuffer) {
    const buffer = await readAll(file);
    file.close();
    body = entity = buffer;
  } else {
    response.addResource(file);
    body = file;
    entity = fileInfo;
  }
  return [
    body,
    entity,
    fileInfo
  ];
}
/** Asynchronously fulfill a response with a file from the local file
 * system.
 *
 * Requires Deno read permission for the `root` directory. */ export async function send(// deno-lint-ignore no-explicit-any
{ request, response }, path, options = {
  root: ""
}) {
  const { brotli = true, contentTypes = {}, extensions, format = true, gzip = true, hidden = false, immutable = false, index, maxbuffer = MAXBUFFER_DEFAULT, maxage = 0, root } = options;
  const trailingSlash = path[path.length - 1] === "/";
  path = decodeComponent(path.substr(parse(path).root.length));
  if (index && trailingSlash) {
    path += index;
  }
  if (!hidden && isHidden(path)) {
    throw createHttpError(403);
  }
  path = resolvePath(root, path);
  let encodingExt = "";
  if (brotli && request.acceptsEncodings("br", "identity") === "br" && await exists(`${path}.br`)) {
    path = `${path}.br`;
    response.headers.set("Content-Encoding", "br");
    response.headers.delete("Content-Length");
    encodingExt = ".br";
  } else if (gzip && request.acceptsEncodings("gzip", "identity") === "gzip" && await exists(`${path}.gz`)) {
    path = `${path}.gz`;
    response.headers.set("Content-Encoding", "gzip");
    response.headers.delete("Content-Length");
    encodingExt = ".gz";
  }
  if (extensions && !/\.[^/]*$/.exec(path)) {
    for (let ext of extensions){
      if (!/^\./.exec(ext)) {
        ext = `.${ext}`;
      }
      if (await exists(`${path}${ext}`)) {
        path += ext;
        break;
      }
    }
  }
  let stats;
  try {
    stats = await Deno.stat(path);
    if (stats.isDirectory) {
      if (format && index) {
        path += `/${index}`;
        stats = await Deno.stat(path);
      } else {
        return;
      }
    }
  } catch (err) {
    if (err instanceof Deno.errors.NotFound) {
      throw createHttpError(404, err.message);
    }
    // TODO(@kitsonk) remove when https://github.com/denoland/node_deno_shims/issues/87 resolved
    if (err instanceof Error && err.message.startsWith("ENOENT:")) {
      throw createHttpError(404, err.message);
    }
    throw createHttpError(500, err instanceof Error ? err.message : "[non-error thrown]");
  }
  let mtime = null;
  if (response.headers.has("Last-Modified")) {
    mtime = new Date(response.headers.get("Last-Modified")).getTime();
  } else if (stats.mtime) {
    // Round down to second because it's the precision of the UTC string.
    mtime = stats.mtime.getTime();
    mtime -= mtime % 1000;
    response.headers.set("Last-Modified", new Date(mtime).toUTCString());
  }
  if (!response.headers.has("Cache-Control")) {
    const directives = [
      `max-age=${maxage / 1000 | 0}`
    ];
    if (immutable) {
      directives.push("immutable");
    }
    response.headers.set("Cache-Control", directives.join(","));
  }
  if (!response.type) {
    response.type = encodingExt !== "" ? extname(basename(path, encodingExt)) : contentTypes[extname(path)] ?? extname(path);
  }
  let entity = null;
  let body = null;
  let fileInfo = null;
  if (request.headers.has("If-None-Match") && mtime) {
    [body, entity, fileInfo] = await getEntity(path, mtime, stats, maxbuffer, response);
    const etag = await calculate(entity);
    if (etag && !ifNoneMatch(request.headers.get("If-None-Match"), etag)) {
      response.headers.set("ETag", etag);
      response.status = 304;
      return path;
    }
  }
  if (request.headers.has("If-Modified-Since") && mtime) {
    const ifModifiedSince = new Date(request.headers.get("If-Modified-Since"));
    if (ifModifiedSince.getTime() >= mtime) {
      response.status = 304;
      return path;
    }
  }
  if (!body || !entity || !fileInfo) {
    [body, entity, fileInfo] = await getEntity(path, mtime ?? 0, stats, maxbuffer, response);
  }
  let returnRanges = undefined;
  let size = undefined;
  if (request.source && body && entity) {
    const { ok, ranges } = ArrayBuffer.isView(body) ? await range(request.source, body, fileInfo) : await range(request.source, fileInfo);
    if (ok && ranges) {
      size = ArrayBuffer.isView(entity) ? entity.byteLength : entity.size;
      returnRanges = ranges;
    } else if (!ok) {
      response.status = Status.RequestedRangeNotSatisfiable;
    }
  }
  if (!response.headers.has("ETag")) {
    const etag = await calculate(entity);
    if (etag) {
      response.headers.set("ETag", etag);
    }
  }
  if (returnRanges && size) {
    response.with(responseRange(body, size, returnRanges, {
      headers: response.headers
    }, {
      type: contentType(response.type)
    }));
  } else {
    response.body = body;
  }
  return path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vanNyLmlvL0BvYWsvb2FrLzE2LjEuMC9zZW5kLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQWRhcHRlZCBmcm9tIGtvYS1zZW5kIGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9rb2Fqcy9zZW5kIGFuZCB3aGljaCBpcyBsaWNlbnNlZFxuICogd2l0aCB0aGUgTUlUIGxpY2Vuc2UuXG4gKi9cblxuLyoqXG4gKiBDb250YWlucyB0aGUgc2VuZCBmdW5jdGlvbiB3aGljaCBjYW4gYmUgdXNlZCB0byBzZW5kIHN0YXRpYyBhc3NldHMgd2hpbGVcbiAqIHN1cHBvcnRpbmcgYSByYW5nZSBvZiBIVFRQIGNhcGFiaWxpdGllcy5cbiAqXG4gKiBUaGlzIGlzIGludGVncmF0ZWQgaW50byB0aGUgb2FrIGNvbnRleHQgdmlhIHRoZSBgLnNlbmQoKWAgbWV0aG9kLlxuICpcbiAqIEBtb2R1bGVcbiAqL1xuXG5pbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tIFwiLi9jb250ZXh0LnRzXCI7XG5pbXBvcnQge1xuICBiYXNlbmFtZSxcbiAgdHlwZSBCeXRlUmFuZ2UsXG4gIGNhbGN1bGF0ZSxcbiAgY29udGVudFR5cGUsXG4gIGNyZWF0ZUh0dHBFcnJvcixcbiAgZXh0bmFtZSxcbiAgdHlwZSBGaWxlSW5mbyxcbiAgaWZOb25lTWF0Y2gsXG4gIHBhcnNlLFxuICByYW5nZSxcbiAgcmVhZEFsbCxcbiAgcmVzcG9uc2VSYW5nZSxcbiAgU3RhdHVzLFxufSBmcm9tIFwiLi9kZXBzLnRzXCI7XG5pbXBvcnQgdHlwZSB7IFJlc3BvbnNlIH0gZnJvbSBcIi4vcmVzcG9uc2UudHNcIjtcbmltcG9ydCB7IGlzTm9kZSB9IGZyb20gXCIuL3V0aWxzL3R5cGVfZ3VhcmRzLnRzXCI7XG5pbXBvcnQgeyBkZWNvZGVDb21wb25lbnQgfSBmcm9tIFwiLi91dGlscy9kZWNvZGVfY29tcG9uZW50LnRzXCI7XG5pbXBvcnQgeyByZXNvbHZlUGF0aCB9IGZyb20gXCIuL3V0aWxzL3Jlc29sdmVfcGF0aC50c1wiO1xuXG5pZiAoaXNOb2RlKCkpIHtcbiAgY29uc29sZS53YXJuKFwib2FrIHNlbmQoKSBkb2VzIG5vdCB3b3JrIHVuZGVyIE5vZGUuanMuXCIpO1xufVxuXG5jb25zdCBNQVhCVUZGRVJfREVGQVVMVCA9IDFfMDQ4XzU3NjsgLy8gMU1pQjtcblxuLyoqIE9wdGlvbnMgd2hpY2ggY2FuIGJlIHNwZWNpZmllZCB3aGVuIHVzaW5nIHRoZSB7QGxpbmtjb2RlIHNlbmR9XG4gKiBtaWRkbGV3YXJlLiAqL1xuZXhwb3J0IGludGVyZmFjZSBTZW5kT3B0aW9ucyB7XG4gIC8qKiBUcnkgdG8gc2VydmUgdGhlIGJyb3RsaSB2ZXJzaW9uIG9mIGEgZmlsZSBhdXRvbWF0aWNhbGx5IHdoZW4gYnJvdGxpIGlzXG4gICAqIHN1cHBvcnRlZCBieSBhIGNsaWVudCBhbmQgaWYgdGhlIHJlcXVlc3RlZCBmaWxlIHdpdGggYC5icmAgZXh0ZW5zaW9uXG4gICAqIGV4aXN0cy4gKGRlZmF1bHRzIHRvIGB0cnVlYCkgKi9cbiAgYnJvdGxpPzogYm9vbGVhbjtcblxuICAvKiogQSByZWNvcmQgb2YgZXh0ZW5zaW9ucyBhbmQgY29udGVudCB0eXBlcyB0aGF0IHNob3VsZCBiZSB1c2VkIHdoZW5cbiAgICogZGV0ZXJtaW5pbmcgdGhlIGNvbnRlbnQgb2YgYSBmaWxlIGJlaW5nIHNlcnZlZC4gQnkgZGVmYXVsdCwgdGhlXG4gICAqIFtgbWVkaWFfdHlwZWBdKGh0dHBzOi8vZ2l0aHViLmNvbS9vYWtzZXJ2ZXIvbWVkaWFfdHlwZXMvKSBkYXRhYmFzZSBpcyB1c2VkXG4gICAqIHRvIG1hcCBhbiBleHRlbnNpb24gdG8gdGhlIHNlcnZlZCBjb250ZW50LXR5cGUuIFRoZSBrZXlzIG9mIHRoZSBtYXAgYXJlXG4gICAqIGV4dGVuc2lvbnMsIGFuZCB2YWx1ZXMgYXJlIHRoZSBjb250ZW50IHR5cGVzIHRvIHVzZS4gVGhlIGNvbnRlbnQgdHlwZSBjYW5cbiAgICogYmUgYSBwYXJ0aWFsIGNvbnRlbnQgdHlwZSwgd2hpY2ggd2lsbCBiZSByZXNvbHZlZCB0byBhIGZ1bGwgY29udGVudCB0eXBlXG4gICAqIGhlYWRlci5cbiAgICpcbiAgICogQW55IGV4dGVuc2lvbnMgbWF0Y2hlZCB3aWxsIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yLiBLZXkgc2hvdWxkXG4gICAqIGluY2x1ZGUgdGhlIGxlYWRpbmcgZG90IChlLmcuIGAuZXh0YCBpbnN0ZWFkIG9mIGp1c3QgYGV4dGApLlxuICAgKlxuICAgKiAjIyMgRXhhbXBsZVxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBhcHAudXNlKChjdHgpID0+IHtcbiAgICogICByZXR1cm4gc2VuZChjdHgsIGN0eC5yZXF1ZXN0LnVybC5wYXRobmFtZSwge1xuICAgKiAgICAgY29udGVudFR5cGVzOiB7XG4gICAqICAgICAgIFwiLmltcG9ydG1hcFwiOiBcImFwcGxpY2F0aW9uL2ltcG9ydG1hcCtqc29uXCJcbiAgICogICAgIH0sXG4gICAqICAgICByb290OiBcIi5cIixcbiAgICogICB9KVxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICBjb250ZW50VHlwZXM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuXG4gIC8qKiBUcnkgdG8gbWF0Y2ggZXh0ZW5zaW9ucyBmcm9tIHBhc3NlZCBhcnJheSB0byBzZWFyY2ggZm9yIGZpbGUgd2hlbiBub1xuICAgKiBleHRlbnNpb24gaXMgc3VmZmljZWQgaW4gVVJMLiBGaXJzdCBmb3VuZCBpcyBzZXJ2ZWQuIChkZWZhdWx0cyB0b1xuICAgKiBgdW5kZWZpbmVkYCkgKi9cbiAgZXh0ZW5zaW9ucz86IHN0cmluZ1tdO1xuXG4gIC8qKiBJZiBgdHJ1ZWAsIGZvcm1hdCB0aGUgcGF0aCB0byBzZXJ2ZSBzdGF0aWMgZmlsZSBzZXJ2ZXJzIGFuZCBub3QgcmVxdWlyZSBhXG4gICAqIHRyYWlsaW5nIHNsYXNoIGZvciBkaXJlY3Rvcmllcywgc28gdGhhdCB5b3UgY2FuIGRvIGJvdGggYC9kaXJlY3RvcnlgIGFuZFxuICAgKiBgL2RpcmVjdG9yeS9gLiAoZGVmYXVsdHMgdG8gYHRydWVgKSAqL1xuICBmb3JtYXQ/OiBib29sZWFuO1xuXG4gIC8qKiBUcnkgdG8gc2VydmUgdGhlIGd6aXBwZWQgdmVyc2lvbiBvZiBhIGZpbGUgYXV0b21hdGljYWxseSB3aGVuIGd6aXAgaXNcbiAgICogc3VwcG9ydGVkIGJ5IGEgY2xpZW50IGFuZCBpZiB0aGUgcmVxdWVzdGVkIGZpbGUgd2l0aCBgLmd6YCBleHRlbnNpb25cbiAgICogZXhpc3RzLiAoZGVmYXVsdHMgdG8gYHRydWVgKS4gKi9cbiAgZ3ppcD86IGJvb2xlYW47XG5cbiAgLyoqIEFsbG93IHRyYW5zZmVyIG9mIGhpZGRlbiBmaWxlcy4gKGRlZmF1bHRzIHRvIGBmYWxzZWApICovXG4gIGhpZGRlbj86IGJvb2xlYW47XG5cbiAgLyoqIFRlbGwgdGhlIGJyb3dzZXIgdGhlIHJlc291cmNlIGlzIGltbXV0YWJsZSBhbmQgY2FuIGJlIGNhY2hlZFxuICAgKiBpbmRlZmluaXRlbHkuIChkZWZhdWx0cyB0byBgZmFsc2VgKSAqL1xuICBpbW11dGFibGU/OiBib29sZWFuO1xuXG4gIC8qKiBOYW1lIG9mIHRoZSBpbmRleCBmaWxlIHRvIHNlcnZlIGF1dG9tYXRpY2FsbHkgd2hlbiB2aXNpdGluZyB0aGUgcm9vdFxuICAgKiBsb2NhdGlvbi4gKGRlZmF1bHRzIHRvIG5vbmUpICovXG4gIGluZGV4Pzogc3RyaW5nO1xuXG4gIC8qKiBCcm93c2VyIGNhY2hlIG1heC1hZ2UgaW4gbWlsbGlzZWNvbmRzLiAoZGVmYXVsdHMgdG8gYDBgKSAqL1xuICBtYXhhZ2U/OiBudW1iZXI7XG5cbiAgLyoqIEEgc2l6ZSBpbiBieXRlcyB3aGVyZSBpZiB0aGUgZmlsZSBpcyBsZXNzIHRoYW4gdGhpcyBzaXplLCB0aGUgZmlsZSB3aWxsXG4gICAqIGJlIHJlYWQgaW50byBtZW1vcnkgYnkgc2VuZCBpbnN0ZWFkIG9mIHJldHVybmluZyBhIGZpbGUgaGFuZGxlLiAgRmlsZXMgbGVzc1xuICAgKiB0aGFuIHRoZSBieXRlIHNpemUgd2lsbCBzZW5kIGFuIFwic3Ryb25nXCIgYEVUYWdgIGhlYWRlciB3aGlsZSB0aG9zZSBsYXJnZXJcbiAgICogdGhhbiB0aGUgYnl0ZXMgc2l6ZSB3aWxsIG9ubHkgYmUgYWJsZSB0byBzZW5kIGEgXCJ3ZWFrXCIgYEVUYWdgIGhlYWRlciAoYXNcbiAgICogdGhleSBjYW5ub3QgaGFzaCB0aGUgY29udGVudHMgb2YgdGhlIGZpbGUpLiAoZGVmYXVsdHMgdG8gMU1pQilcbiAgICovXG4gIG1heGJ1ZmZlcj86IG51bWJlcjtcblxuICAvKiogUm9vdCBkaXJlY3RvcnkgdG8gcmVzdHJpY3QgZmlsZSBhY2Nlc3MuICovXG4gIHJvb3Q6IHN0cmluZztcbn1cblxuZnVuY3Rpb24gaXNIaWRkZW4ocGF0aDogc3RyaW5nKSB7XG4gIGNvbnN0IHBhdGhBcnIgPSBwYXRoLnNwbGl0KFwiL1wiKTtcbiAgZm9yIChjb25zdCBzZWdtZW50IG9mIHBhdGhBcnIpIHtcbiAgICBpZiAoc2VnbWVudFswXSA9PT0gXCIuXCIgJiYgc2VnbWVudCAhPT0gXCIuXCIgJiYgc2VnbWVudCAhPT0gXCIuLlwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4aXN0cyhwYXRoOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gKGF3YWl0IERlbm8uc3RhdChwYXRoKSkuaXNGaWxlO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RW50aXR5KFxuICBwYXRoOiBzdHJpbmcsXG4gIG10aW1lOiBudW1iZXIsXG4gIHN0YXRzOiBEZW5vLkZpbGVJbmZvLFxuICBtYXhidWZmZXI6IG51bWJlcixcbiAgcmVzcG9uc2U6IFJlc3BvbnNlLFxuKTogUHJvbWlzZTxbVWludDhBcnJheSB8IERlbm8uRnNGaWxlLCBVaW50OEFycmF5IHwgRmlsZUluZm8sIEZpbGVJbmZvXT4ge1xuICBsZXQgYm9keTogVWludDhBcnJheSB8IERlbm8uRnNGaWxlO1xuICBsZXQgZW50aXR5OiBVaW50OEFycmF5IHwgRmlsZUluZm87XG4gIGNvbnN0IGZpbGVJbmZvID0geyBtdGltZTogbmV3IERhdGUobXRpbWUpLCBzaXplOiBzdGF0cy5zaXplIH07XG4gIGNvbnN0IGZpbGUgPSBhd2FpdCBEZW5vLm9wZW4ocGF0aCwgeyByZWFkOiB0cnVlIH0pO1xuICBpZiAoc3RhdHMuc2l6ZSA8IG1heGJ1ZmZlcikge1xuICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IHJlYWRBbGwoZmlsZSk7XG4gICAgZmlsZS5jbG9zZSgpO1xuICAgIGJvZHkgPSBlbnRpdHkgPSBidWZmZXI7XG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UuYWRkUmVzb3VyY2UoZmlsZSk7XG4gICAgYm9keSA9IGZpbGU7XG4gICAgZW50aXR5ID0gZmlsZUluZm87XG4gIH1cbiAgcmV0dXJuIFtib2R5LCBlbnRpdHksIGZpbGVJbmZvXTtcbn1cblxuLyoqIEFzeW5jaHJvbm91c2x5IGZ1bGZpbGwgYSByZXNwb25zZSB3aXRoIGEgZmlsZSBmcm9tIHRoZSBsb2NhbCBmaWxlXG4gKiBzeXN0ZW0uXG4gKlxuICogUmVxdWlyZXMgRGVubyByZWFkIHBlcm1pc3Npb24gZm9yIHRoZSBgcm9vdGAgZGlyZWN0b3J5LiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmQoXG4gIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gIHsgcmVxdWVzdCwgcmVzcG9uc2UgfTogQ29udGV4dDxhbnk+LFxuICBwYXRoOiBzdHJpbmcsXG4gIG9wdGlvbnM6IFNlbmRPcHRpb25zID0geyByb290OiBcIlwiIH0sXG4pOiBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD4ge1xuICBjb25zdCB7XG4gICAgYnJvdGxpID0gdHJ1ZSxcbiAgICBjb250ZW50VHlwZXMgPSB7fSxcbiAgICBleHRlbnNpb25zLFxuICAgIGZvcm1hdCA9IHRydWUsXG4gICAgZ3ppcCA9IHRydWUsXG4gICAgaGlkZGVuID0gZmFsc2UsXG4gICAgaW1tdXRhYmxlID0gZmFsc2UsXG4gICAgaW5kZXgsXG4gICAgbWF4YnVmZmVyID0gTUFYQlVGRkVSX0RFRkFVTFQsXG4gICAgbWF4YWdlID0gMCxcbiAgICByb290LFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgdHJhaWxpbmdTbGFzaCA9IHBhdGhbcGF0aC5sZW5ndGggLSAxXSA9PT0gXCIvXCI7XG4gIHBhdGggPSBkZWNvZGVDb21wb25lbnQocGF0aC5zdWJzdHIocGFyc2UocGF0aCkucm9vdC5sZW5ndGgpKTtcbiAgaWYgKGluZGV4ICYmIHRyYWlsaW5nU2xhc2gpIHtcbiAgICBwYXRoICs9IGluZGV4O1xuICB9XG5cbiAgaWYgKCFoaWRkZW4gJiYgaXNIaWRkZW4ocGF0aCkpIHtcbiAgICB0aHJvdyBjcmVhdGVIdHRwRXJyb3IoNDAzKTtcbiAgfVxuXG4gIHBhdGggPSByZXNvbHZlUGF0aChyb290LCBwYXRoKTtcblxuICBsZXQgZW5jb2RpbmdFeHQgPSBcIlwiO1xuICBpZiAoXG4gICAgYnJvdGxpICYmXG4gICAgcmVxdWVzdC5hY2NlcHRzRW5jb2RpbmdzKFwiYnJcIiwgXCJpZGVudGl0eVwiKSA9PT0gXCJiclwiICYmXG4gICAgKGF3YWl0IGV4aXN0cyhgJHtwYXRofS5icmApKVxuICApIHtcbiAgICBwYXRoID0gYCR7cGF0aH0uYnJgO1xuICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFwiQ29udGVudC1FbmNvZGluZ1wiLCBcImJyXCIpO1xuICAgIHJlc3BvbnNlLmhlYWRlcnMuZGVsZXRlKFwiQ29udGVudC1MZW5ndGhcIik7XG4gICAgZW5jb2RpbmdFeHQgPSBcIi5iclwiO1xuICB9IGVsc2UgaWYgKFxuICAgIGd6aXAgJiZcbiAgICByZXF1ZXN0LmFjY2VwdHNFbmNvZGluZ3MoXCJnemlwXCIsIFwiaWRlbnRpdHlcIikgPT09IFwiZ3ppcFwiICYmXG4gICAgKGF3YWl0IGV4aXN0cyhgJHtwYXRofS5nemApKVxuICApIHtcbiAgICBwYXRoID0gYCR7cGF0aH0uZ3pgO1xuICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFwiQ29udGVudC1FbmNvZGluZ1wiLCBcImd6aXBcIik7XG4gICAgcmVzcG9uc2UuaGVhZGVycy5kZWxldGUoXCJDb250ZW50LUxlbmd0aFwiKTtcbiAgICBlbmNvZGluZ0V4dCA9IFwiLmd6XCI7XG4gIH1cblxuICBpZiAoZXh0ZW5zaW9ucyAmJiAhL1xcLlteL10qJC8uZXhlYyhwYXRoKSkge1xuICAgIGZvciAobGV0IGV4dCBvZiBleHRlbnNpb25zKSB7XG4gICAgICBpZiAoIS9eXFwuLy5leGVjKGV4dCkpIHtcbiAgICAgICAgZXh0ID0gYC4ke2V4dH1gO1xuICAgICAgfVxuICAgICAgaWYgKGF3YWl0IGV4aXN0cyhgJHtwYXRofSR7ZXh0fWApKSB7XG4gICAgICAgIHBhdGggKz0gZXh0O1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBsZXQgc3RhdHM6IERlbm8uRmlsZUluZm87XG4gIHRyeSB7XG4gICAgc3RhdHMgPSBhd2FpdCBEZW5vLnN0YXQocGF0aCk7XG5cbiAgICBpZiAoc3RhdHMuaXNEaXJlY3RvcnkpIHtcbiAgICAgIGlmIChmb3JtYXQgJiYgaW5kZXgpIHtcbiAgICAgICAgcGF0aCArPSBgLyR7aW5kZXh9YDtcbiAgICAgICAgc3RhdHMgPSBhd2FpdCBEZW5vLnN0YXQocGF0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoZXJyIGluc3RhbmNlb2YgRGVuby5lcnJvcnMuTm90Rm91bmQpIHtcbiAgICAgIHRocm93IGNyZWF0ZUh0dHBFcnJvcig0MDQsIGVyci5tZXNzYWdlKTtcbiAgICB9XG4gICAgLy8gVE9ETyhAa2l0c29uaykgcmVtb3ZlIHdoZW4gaHR0cHM6Ly9naXRodWIuY29tL2Rlbm9sYW5kL25vZGVfZGVub19zaGltcy9pc3N1ZXMvODcgcmVzb2x2ZWRcbiAgICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IgJiYgZXJyLm1lc3NhZ2Uuc3RhcnRzV2l0aChcIkVOT0VOVDpcIikpIHtcbiAgICAgIHRocm93IGNyZWF0ZUh0dHBFcnJvcig0MDQsIGVyci5tZXNzYWdlKTtcbiAgICB9XG4gICAgdGhyb3cgY3JlYXRlSHR0cEVycm9yKFxuICAgICAgNTAwLFxuICAgICAgZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6IFwiW25vbi1lcnJvciB0aHJvd25dXCIsXG4gICAgKTtcbiAgfVxuXG4gIGxldCBtdGltZTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIGlmIChyZXNwb25zZS5oZWFkZXJzLmhhcyhcIkxhc3QtTW9kaWZpZWRcIikpIHtcbiAgICBtdGltZSA9IG5ldyBEYXRlKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KFwiTGFzdC1Nb2RpZmllZFwiKSEpLmdldFRpbWUoKTtcbiAgfSBlbHNlIGlmIChzdGF0cy5tdGltZSkge1xuICAgIC8vIFJvdW5kIGRvd24gdG8gc2Vjb25kIGJlY2F1c2UgaXQncyB0aGUgcHJlY2lzaW9uIG9mIHRoZSBVVEMgc3RyaW5nLlxuICAgIG10aW1lID0gc3RhdHMubXRpbWUuZ2V0VGltZSgpO1xuICAgIG10aW1lIC09IG10aW1lICUgMTAwMDtcbiAgICByZXNwb25zZS5oZWFkZXJzLnNldChcIkxhc3QtTW9kaWZpZWRcIiwgbmV3IERhdGUobXRpbWUpLnRvVVRDU3RyaW5nKCkpO1xuICB9XG5cbiAgaWYgKCFyZXNwb25zZS5oZWFkZXJzLmhhcyhcIkNhY2hlLUNvbnRyb2xcIikpIHtcbiAgICBjb25zdCBkaXJlY3RpdmVzID0gW2BtYXgtYWdlPSR7KG1heGFnZSAvIDEwMDApIHwgMH1gXTtcbiAgICBpZiAoaW1tdXRhYmxlKSB7XG4gICAgICBkaXJlY3RpdmVzLnB1c2goXCJpbW11dGFibGVcIik7XG4gICAgfVxuICAgIHJlc3BvbnNlLmhlYWRlcnMuc2V0KFwiQ2FjaGUtQ29udHJvbFwiLCBkaXJlY3RpdmVzLmpvaW4oXCIsXCIpKTtcbiAgfVxuICBpZiAoIXJlc3BvbnNlLnR5cGUpIHtcbiAgICByZXNwb25zZS50eXBlID0gZW5jb2RpbmdFeHQgIT09IFwiXCJcbiAgICAgID8gZXh0bmFtZShiYXNlbmFtZShwYXRoLCBlbmNvZGluZ0V4dCkpXG4gICAgICA6IGNvbnRlbnRUeXBlc1tleHRuYW1lKHBhdGgpXSA/PyBleHRuYW1lKHBhdGgpO1xuICB9XG5cbiAgbGV0IGVudGl0eTogVWludDhBcnJheSB8IEZpbGVJbmZvIHwgbnVsbCA9IG51bGw7XG4gIGxldCBib2R5OiBVaW50OEFycmF5IHwgRGVuby5Gc0ZpbGUgfCBudWxsID0gbnVsbDtcbiAgbGV0IGZpbGVJbmZvOiBGaWxlSW5mbyB8IG51bGwgPSBudWxsO1xuXG4gIGlmIChyZXF1ZXN0LmhlYWRlcnMuaGFzKFwiSWYtTm9uZS1NYXRjaFwiKSAmJiBtdGltZSkge1xuICAgIFtib2R5LCBlbnRpdHksIGZpbGVJbmZvXSA9IGF3YWl0IGdldEVudGl0eShcbiAgICAgIHBhdGgsXG4gICAgICBtdGltZSxcbiAgICAgIHN0YXRzLFxuICAgICAgbWF4YnVmZmVyLFxuICAgICAgcmVzcG9uc2UsXG4gICAgKTtcbiAgICBjb25zdCBldGFnID0gYXdhaXQgY2FsY3VsYXRlKGVudGl0eSk7XG4gICAgaWYgKFxuICAgICAgZXRhZyAmJiAoIWlmTm9uZU1hdGNoKHJlcXVlc3QuaGVhZGVycy5nZXQoXCJJZi1Ob25lLU1hdGNoXCIpISwgZXRhZykpXG4gICAgKSB7XG4gICAgICByZXNwb25zZS5oZWFkZXJzLnNldChcIkVUYWdcIiwgZXRhZyk7XG4gICAgICByZXNwb25zZS5zdGF0dXMgPSAzMDQ7XG4gICAgICByZXR1cm4gcGF0aDtcbiAgICB9XG4gIH1cblxuICBpZiAocmVxdWVzdC5oZWFkZXJzLmhhcyhcIklmLU1vZGlmaWVkLVNpbmNlXCIpICYmIG10aW1lKSB7XG4gICAgY29uc3QgaWZNb2RpZmllZFNpbmNlID0gbmV3IERhdGUocmVxdWVzdC5oZWFkZXJzLmdldChcIklmLU1vZGlmaWVkLVNpbmNlXCIpISk7XG4gICAgaWYgKGlmTW9kaWZpZWRTaW5jZS5nZXRUaW1lKCkgPj0gbXRpbWUpIHtcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IDMwNDtcbiAgICAgIHJldHVybiBwYXRoO1xuICAgIH1cbiAgfVxuXG4gIGlmICghYm9keSB8fCAhZW50aXR5IHx8ICFmaWxlSW5mbykge1xuICAgIFtib2R5LCBlbnRpdHksIGZpbGVJbmZvXSA9IGF3YWl0IGdldEVudGl0eShcbiAgICAgIHBhdGgsXG4gICAgICBtdGltZSA/PyAwLFxuICAgICAgc3RhdHMsXG4gICAgICBtYXhidWZmZXIsXG4gICAgICByZXNwb25zZSxcbiAgICApO1xuICB9XG5cbiAgbGV0IHJldHVyblJhbmdlczogQnl0ZVJhbmdlW10gfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gIGxldCBzaXplOiBudW1iZXIgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG5cbiAgaWYgKHJlcXVlc3Quc291cmNlICYmIGJvZHkgJiYgZW50aXR5KSB7XG4gICAgY29uc3QgeyBvaywgcmFuZ2VzIH0gPSBBcnJheUJ1ZmZlci5pc1ZpZXcoYm9keSlcbiAgICAgID8gYXdhaXQgcmFuZ2UocmVxdWVzdC5zb3VyY2UsIGJvZHksIGZpbGVJbmZvKVxuICAgICAgOiBhd2FpdCByYW5nZShyZXF1ZXN0LnNvdXJjZSwgZmlsZUluZm8pO1xuICAgIGlmIChvayAmJiByYW5nZXMpIHtcbiAgICAgIHNpemUgPSBBcnJheUJ1ZmZlci5pc1ZpZXcoZW50aXR5KSA/IGVudGl0eS5ieXRlTGVuZ3RoIDogZW50aXR5LnNpemU7XG4gICAgICByZXR1cm5SYW5nZXMgPSByYW5nZXM7XG4gICAgfSBlbHNlIGlmICghb2spIHtcbiAgICAgIHJlc3BvbnNlLnN0YXR1cyA9IFN0YXR1cy5SZXF1ZXN0ZWRSYW5nZU5vdFNhdGlzZmlhYmxlO1xuICAgIH1cbiAgfVxuXG4gIGlmICghcmVzcG9uc2UuaGVhZGVycy5oYXMoXCJFVGFnXCIpKSB7XG4gICAgY29uc3QgZXRhZyA9IGF3YWl0IGNhbGN1bGF0ZShlbnRpdHkpO1xuICAgIGlmIChldGFnKSB7XG4gICAgICByZXNwb25zZS5oZWFkZXJzLnNldChcIkVUYWdcIiwgZXRhZyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHJldHVyblJhbmdlcyAmJiBzaXplKSB7XG4gICAgcmVzcG9uc2Uud2l0aChcbiAgICAgIHJlc3BvbnNlUmFuZ2UoYm9keSwgc2l6ZSwgcmV0dXJuUmFuZ2VzLCB7IGhlYWRlcnM6IHJlc3BvbnNlLmhlYWRlcnMgfSwge1xuICAgICAgICB0eXBlOiBjb250ZW50VHlwZShyZXNwb25zZS50eXBlKSxcbiAgICAgIH0pLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UuYm9keSA9IGJvZHk7XG4gIH1cblxuICByZXR1cm4gcGF0aDtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0NBR0MsR0FFRDs7Ozs7OztDQU9DLEdBR0QsU0FDRSxRQUFRLEVBRVIsU0FBUyxFQUNULFdBQVcsRUFDWCxlQUFlLEVBQ2YsT0FBTyxFQUVQLFdBQVcsRUFDWCxLQUFLLEVBQ0wsS0FBSyxFQUNMLE9BQU8sRUFDUCxhQUFhLEVBQ2IsTUFBTSxRQUNELFlBQVk7QUFFbkIsU0FBUyxNQUFNLFFBQVEseUJBQXlCO0FBQ2hELFNBQVMsZUFBZSxRQUFRLDhCQUE4QjtBQUM5RCxTQUFTLFdBQVcsUUFBUSwwQkFBMEI7QUFFdEQsSUFBSSxVQUFVO0VBQ1osUUFBUSxJQUFJLENBQUM7QUFDZjtBQUVBLE1BQU0sb0JBQW9CLFdBQVcsUUFBUTtBQTZFN0MsU0FBUyxTQUFTLElBQVk7RUFDNUIsTUFBTSxVQUFVLEtBQUssS0FBSyxDQUFDO0VBQzNCLEtBQUssTUFBTSxXQUFXLFFBQVM7SUFDN0IsSUFBSSxPQUFPLENBQUMsRUFBRSxLQUFLLE9BQU8sWUFBWSxPQUFPLFlBQVksTUFBTTtNQUM3RCxPQUFPO0lBQ1Q7SUFDQSxPQUFPO0VBQ1Q7QUFD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